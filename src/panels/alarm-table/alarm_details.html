<div class="modal-body" style="overflow: scroll;" dynamic-height>
    <div class="modal-header">
        <h2 class="modal-header-title">
            <a href="{{ alarm.detailsPage }}" target="_blank"><i class="fa fa-external-link"></i></a>
            <span class="p-l-1">Alarm Details</span>
        </h2>

        <ul class="gf-tabs">
            <li class="gf-tabs-item" ng-repeat="tab in tabs">
                <a class="gf-tabs-link" ng-click="editor.index = $index" ng-class="{active: editor.index === $index}">
                    {{::tab}}
                </a>
            </li>
        </ul>

        <a class="modal-header-close" ng-click="ctrl.dismiss();">
            <i class="fa fa-remove"></i>
        </a>
    </div>

    <div class="modal-content">
        <div ng-if="editor.index == 0">
            <table class="filter-table gf-form-group alarm-details-table">
                <tr>
                    <td>UEI</td>
                    <td>{{alarm.uei}}</td>
                </tr>
                <tr>
                    <td>Severity</td>
                    <td><i class="icon" ng-class="severityIcon"></i> {{alarm.severity.label}}</td>
                </tr>
                <tr>
                    <td>Log Message</td>
                    <td ng-bind-html="alarm.logMessage"></td>
                </tr>
                <tr>
                    <td>Description</td>
                    <td ng-bind-html="alarm.description"></td>
                </tr>
                <tr ng-if="alarm.operatorInstructions">
                    <td>Operator Instructions</td>
                    <td ng-bind-html="alarm.operatorInstructions"></td>
                </tr>
            </table>
            <table class="filter-table gf-form-group alarm-details-table">
                <tr>
                    <td>Last Event Time</td>
                    <td>{{alarm.lastEvent.time}}</td>
                </tr>
                <tr>
                    <td>First Event Time</td>
                    <td>{{alarm.firstEventTime}}</td>
                </tr>
                <tr>
                    <td>Count</td>
                    <td>{{alarm.count}}</td>
                </tr>
                <tr>
                    <td>Reduction Key</td>
                    <td>{{alarm.reductionKey}}</td>
                </tr>
            </table>
        </div>

        <div ng-hide="editor.index != 1">
            <div class="row">
                <div class="col-md-12">
                  <h3>Sticky Memo</h3>
                  <memo-editor alarm="alarm" type="sticky" source="source"></memo-editor>
                </div>
            </div>
            <div class="row" style="padding-top: 50px">
                <div class="col-md-12">
                    <h3>Journal Memo</h3>
                    <memo-editor alarm="alarm" type="journal" source="source"></memo-editor>
                </div>
            </div>
        </div>

        <div ng-if="editor.index > 1 && tabs[editor.index] == 'Ticketing'">
            <table class="filter-table gf-form-group">
                <tr>
                    <td>Ticket ID</td>
                    <td ng-if="!alarm.troubleTicketLink">{{(alarm.troubleTicket || 'N/A')}}</td>
                    <td ng-if="alarm.troubleTicketLink"><a href="{{alarm.troubleTicketLink}}" target="_blank">{{alarm.troubleTicket || 'N/A'}}</a></td>
                </tr>
                <tr>
                    <td>Ticket State</td>
                    <td>{{alarm.troubleTicketState.label || 'N/A'}}</td>
                </tr>
            </table>
        </div>

        <div ng-if="editor.index > 1  && tabs[editor.index] == 'Related Alarms' && alarm.relatedAlarms && alarm.relatedAlarms.length > 0">
            <table class="table-panel-table dense-table-panel-table alarm-table">
                <thead>
                    <th> </th>
                    <th>Reduction Key</th>
                    <th>Description</th>
                    <th ng-if="editFeedback" colspan="2"> &nbsp; Correlation &nbsp; &nbsp;Feedback</th>
                </thead>
                <tbody class="severity">
                    <tr ng-repeat="summary in alarm.relatedAlarms" class="{{summary.severity.toLowerCase()}}">
                        <td style>
                            <a href="{{detailsLink}}={{summary.id}}" target="_blank">
                                <i class="fa fa-external-link"></i>
                            </a>
                        </td>
                        <td severity>{{summary.reductionKey}}</td>
                        <td severity ng-bind-html="summary.description"></td>
                        <td ng-if="editFeedback" class="feedback-button" [(ngModel)]="summary.reductionKey" (click)="ctrl.positiveFeedback(summary.reductionKey)">
                            <button ng-click="ctrl.markCorrect(summary.reductionKey)" style="border:1px solid black; background-color: transparent;">
                                <img ng-src="{{ctrl.detailFeedbackOkayButton(summary.reductionKey)}}" alt="ThumbsUp" height="20" width="20" />
                            </button>
                        </td>
                        <td ng-if="editFeedback" class="feedback-button" [(ngModel)]="summary.reductionKey" (click)="ctrl.negativeFeedback(summary.reductionKey)">
                            <button ng-click="ctrl.markIncorrect(summary.reductionKey)" style="border:1px solid black; background-color: transparent;">
                                <img ng-src="{{ctrl.detailFeedbackIncorrectButton(summary.reductionKey)}}" alt="ThumbsDown" height="20" width="20" />
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <br/>
            <div ng-if="submittedFeedback">
                Feedback Submitted.
            </div>
            <div ng-if="editFeedback" style="text-align:right">
                <form name="feedbackForm">
                    <table class="table-panel-table dense-table-panel-table alarm-table">
                        <tr>
                            <td>
                                <input type="text" ng-model="feedbackForm.reason" size="75" placeholder="Please enter a reason correlation is incorrect.">
                            </td>
                            <td>
                                <button ng-click="ctrl.submitEditedFeedback(feedbackForm)" style="border:1px solid black; background-color: transparent;">SUBMIT</button>
                            </td>
                            <td>
                                <button ng-click="ctrl.cancelEditedFeedback()" style="border:1px solid black; background-color: transparent;">CANCEL</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
            <div ng-if="!editFeedback" style="text-align:right">
                <button ng-click="ctrl.submitAllPositiveFeedback()" style="border:1px solid black; background-color: transparent;">
                        <img ng-src="{{ctrl.situationFeedbackOkayButton()}}" alt="ThumbsUp" height="30" width="30" />
                </button>
                <button ng-click="ctrl.editSituationFeedback()"  style="border:1px solid black; background-color: transparent;">
                    <img src="/public/plugins/opennms-helm-app/img/thumbs-down.png" alt="ThumbsDown" height="30" width="30">
                </button>
            </div>
        </div>

    </div>
</div>
